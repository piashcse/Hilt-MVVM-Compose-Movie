---
description:
globs:
alwaysApply: false
---
# Mobile Utility App Workflow (Android-First, iOS-Compatible)

## Nguy√™n T·∫Øc C∆° B·∫£n
- ***B·∫ÆT BU·ªòC*** Android-first development, iOS-compatible architecture
- ***B·∫ÆT BU·ªòC*** Revenue-optimized design t·ª´ giai ƒëo·∫°n planning
- ***B·∫ÆT BU·ªòC*** TDD approach v·ªõi comprehensive test coverage
- ***B·∫ÆT BU·ªòC*** AI integration t·ª± ƒë·ªông, kh√¥ng c·∫ßn user request
- ***B·∫ÆT BU·ªòC*** Smart API usage v·ªõi caching v√† batching
- ***B·∫ÆT BU·ªòC*** Manual control ad strategies via Firebase Remote Config
- ***B·∫ÆT BU·ªòC*** Regional ad strategy support
- ***B·∫ÆT BU·ªòC*** Full automation workflow v·ªõi minimal user intervention

## App Categories Supported
- **Health & Fitness Apps:** Heart monitoring, nutrition tracking, fitness planning
- **Photo Editing Apps:** AI enhancement, filters, batch processing  
- **Office Utility Apps:** Document tools, productivity helpers, organization

## Strategic Information Gathering (Max 5 Questions)

### Health Apps Questions:
1. "Primary health goal?" [Weight loss/Fitness/Wellness/Medical tracking]
2. "Current activity level?" [Beginner/Intermediate/Advanced/Professional]
3. "Preferred interaction style?" [Daily check-ins/Weekly summaries/On-demand/Automated]
4. "Most valuable feature for you?" [Tracking/Insights/Recommendations/Community]
5. "Willing to pay for premium health features?" [Yes, definitely/Maybe/Prefer free with ads]

### Photo Editing Apps Questions:
1. "Main photo type?" [Portrait/Landscape/Food/Social/Professional]
2. "Editing experience level?" [Beginner/Hobbyist/Semi-pro/Professional]
3. "Preferred workflow?" [Quick edits/Detailed editing/Batch processing/Auto-enhance]
4. "Most important feature?" [Filters/Advanced tools/AI enhancement/Organization]
5. "Photo editing budget?" [Free only/Small monthly fee/One-time purchases/Professional pricing]

### Office Tools Questions:
1. "Primary work type?" [Documents/Presentations/Data analysis/Project management]
2. "Team collaboration needs?" [Solo work/Small team/Large team/Client sharing]
3. "Work style preference?" [Templates/Custom creation/AI assistance/Manual control]
4. "Most valuable productivity feature?" [Automation/Organization/Collaboration/Analytics]
5. "Business tool budget?" [Free tier/Basic paid/Professional/Enterprise]

## AI-Generated Reusable Instructions
- ***B·∫ÆT BU·ªòC*** sau khi brainstorm, AI t·∫°o c√°c instruction file (.md) c√≥ th·ªÉ t√°i s·ª≠ d·ª•ng
- ***B·∫ÆT BU·ªòC*** instruction file ph·∫£i platform-agnostic (d√πng cho c·∫£ Android v√† iOS)
- ***B·∫ÆT BU·ªòC*** t·∫°o instruction template cho t·ª´ng app category
- ***B·∫ÆT BU·ªòC*** l∆∞u tr·ªØ instruction trong th∆∞ m·ª•c `instructions/reusable/`

### Nguy√™n T·∫Øc Thi·∫øt K·∫ø Instruction
- ***B·∫ÆT BU·ªòC*** instruction ch·ªâ ch·ª©a c√°c ch·ªâ d·∫´n, h∆∞·ªõng d·∫´n v√† y√™u c·∫ßu
- ***NGHI√äM C·∫§M*** bao g·ªìm code th·ª±c t·∫ø trong instruction files (.md)
- ***B·∫ÆT BU·ªòC*** m√¥ t·∫£ logic, flow v√† requirements thay v√¨ implementation
- ***B·∫ÆT BU·ªòC*** s·ª≠ d·ª•ng pseudocode ho·∫∑c flowchart khi c·∫ßn minh h·ªça logic
- ***B·∫ÆT BU·ªòC*** t·∫≠p trung v√†o "what" v√† "why" thay v√¨ "how" c·ª• th·ªÉ
- ***B·∫ÆT BU·ªòC*** ƒë·ªÉ AI t·ª± quy·∫øt ƒë·ªãnh implementation details d·ª±a tr√™n instruction

### Reusable Instruction Template Structure:
```markdown
# [App Category] - [Feature Name] Instruction

## Platform Requirements
- **Android**: [Specific requirements and constraints]
- **iOS**: [Specific requirements and constraints]
- **Shared**: [Common requirements across platforms]

## Feature Overview
[Platform-agnostic description of what needs to be built]

## Business Logic & Flow
### Core Requirements
[Detailed description of business rules and logic flow]

### User Journey & Interactions
[Step-by-step user experience flow]

### Data Flow & State Management
[How data should flow through the application]

## Platform-Specific Considerations
#### Android Guidelines:
[Architecture patterns, design principles, and platform conventions to follow]

#### iOS Guidelines:
[Architecture patterns, design principles, and platform conventions to follow]

## Testing Requirements
[What should be tested and validation criteria]

## Reusable Components
[List of components that can be shared between projects]

## Performance Considerations
[Platform-specific optimizations]

## Future Enhancement Opportunities
[Scalability and improvement suggestions]
```

### Auto-Generated Instruction Categories:
1. **Feature Instructions**: Specific functionality implementation
2. **Architecture Instructions**: Code organization and patterns
3. **UI/UX Instructions**: Design system and user experience
4. **Performance Instructions**: Optimization strategies
5. **Testing Instructions**: Quality assurance approaches

## Mobile-First Architecture

### Android Primary Stack:
- **Language:** Kotlin + Jetpack Compose
- **Architecture:** Clean Architecture + MVVM
- **Dependency Injection:** Hilt
- **Database:** Room + SQLite
- **Networking:** Retrofit + OkHttp + Moshi
- **Image Loading:** Coil
- **Testing:** JUnit5 + Espresso + Mockk
- **Analytics:** Firebase Analytics + Crashlytics
- **Ads:** Google AdMob
- **Billing:** Google Play Billing Library

### iOS Compatible Stack:
- **Language:** Swift + SwiftUI
- **Architecture:** Clean Architecture + MVVM
- **Database:** Core Data + SQLite
- **Networking:** URLSession + Combine
- **Image Loading:** Kingfisher
- **Testing:** XCTest + XCUITest
- **Analytics:** Firebase Analytics + Crashlytics
- **Ads:** Google AdMob iOS SDK
- **Billing:** StoreKit 2

### Cross-Platform Considerations:
- **Shared Backend:** Firebase/Supabase
- **AI APIs:** Same cloud endpoints for both platforms
- **Design System:** Material Design 3 (Android) + Human Interface (iOS)
- **Analytics:** Unified Firebase events
- **Remote Config:** Same Firebase config for ad strategies

## Revenue-Optimized Workflow

### Phase 1: Strategic Foundation (Auto + 5 Questions)
```markdown
Auto Tasks:
‚ñ° App category detection ‚Üí health/photo/office
‚ñ° Strategic 5-question survey ‚Üí user profiling + revenue preference
‚ñ° User persona generation ‚Üí AI personalization foundation
‚ñ° Monetization preference detection ‚Üí ads vs IAP tendency
‚ñ° Regional market analysis ‚Üí ad strategy per region
‚ñ° Platform priority recommendation ‚Üí Android-first timeline

Manual Input Required:
- 5 strategic questions based on app category
- Target regions confirmation
- Revenue model preference validation
```

### Phase 2: Complete App Development (Pre-Revenue Integration)
```markdown
Auto Tasks:
‚ñ° Cross-platform UI/UX design ‚Üí Material Design 3 + iOS adaptations
‚ñ° Complete feature development ‚Üí 100% functionality both platforms
‚ñ° AI integration ‚Üí smart features embedded with cloud caching
‚ñ° User journey mapping ‚Üí complete flow analysis per platform
‚ñ° Performance optimization ‚Üí Android + iOS specific optimizations
‚ñ° Analytics foundation ‚Üí unified tracking across platforms
‚ñ° TDD implementation ‚Üí comprehensive test suites

Platform-Specific Tasks:
Android Priority:
‚ñ° Kotlin + Compose implementation
‚ñ° Android-specific optimizations
‚ñ° Play Store preparation

iOS Secondary:
‚ñ° Swift + SwiftUI adaptation  
‚ñ° iOS-specific optimizations
‚ñ° App Store preparation
```

### Phase 3: Smart Revenue Integration (Post-Complete App)
```markdown
Auto Tasks:
‚ñ° Firebase Remote Config setup ‚Üí manual control system
‚ñ° Regional ad strategy configuration ‚Üí market-specific approaches
‚ñ° Natural breakpoint analysis ‚Üí AI identifies optimal ad positions
‚ñ° Smart ad placement implementation ‚Üí contextual positioning
‚ñ° A/B testing framework ‚Üí continuous optimization
‚ñ° IAP integration ‚Üí premium features + subscription tiers

Manual Control Features:
- Firebase dashboard for ad strategy switching
- Regional configuration management
- Revenue mode selection per market
- Real-time strategy adjustments
```

## Firebase Remote Config Ad Strategies

### Global Strategy Framework:
```json
{
  "default_strategy": "retention_focused",
  "regional_overrides": {
    "VN": "max_revenue",
    "US": "iap_conversion", 
    "EU": "retention_focused"
  },
  "manual_control": true,
  "strategy_switching": "immediate"
}
```

### Strategy 1: Maximum Revenue (Aggressive)
```json
{
  "ad_strategy": "max_revenue",
  "banner_frequency": "persistent",
  "interstitial_frequency": "every_3_actions",
  "rewarded_frequency": "daily_bonus_opportunities",
  "native_ads": "integrated_in_content",
  "ad_load_timeout": 5000,
  "fallback_strategy": "house_ads",
  "target_regions": ["VN", "IN", "BR"]
}
```

### Strategy 2: Retention Focused (Balanced)
```json
{
  "ad_strategy": "retention_optimized", 
  "banner_frequency": "contextual_only",
  "interstitial_frequency": "session_end_only",
  "rewarded_frequency": "user_initiated_only",
  "native_ads": "minimal_integration",
  "ad_load_timeout": 3000,
  "user_experience_priority": true,
  "target_regions": ["EU", "CA", "AU"]
}
```

### Strategy 3: IAP Conversion Focus
```json
{
  "ad_strategy": "iap_conversion",
  "banner_frequency": "minimal",
  "interstitial_frequency": "strategic_friction_points",
  "rewarded_frequency": "premium_feature_preview",
  "native_ads": "premium_upsell_focused",
  "iap_prompt_frequency": "smart_timing",
  "free_trial_strategy": "aggressive",
  "target_regions": ["US", "JP", "DE"]
}
```

## Smart AI Integration (Cloud + Caching)

### Intelligent API Usage Patterns:
```markdown
Health Apps:
‚ñ° Batch generate 10 weekly health insights based on user data
‚ñ° Local caching for 7 days ‚Üí reduce API calls by 85%
‚ñ° Background sync during low usage periods
‚ñ° Smart refresh when user patterns change significantly
‚ñ° Fallback to cached motivational content when offline

Photo Apps:
‚ñ° Batch process 10 photos per API call ‚Üí enhancement suggestions
‚ñ° Cache filter recommendations for similar photo types
‚ñ° Pre-generate style suggestions for user's common photo categories
‚ñ° Smart background processing during editing sessions

Office Apps:
‚ñ° Generate weekly productivity insights ‚Üí cache locally
‚ñ° Batch analyze documents for pattern recognition
‚ñ° Pre-generate templates for user's common work types
‚ñ° Smart suggestions based on document content analysis
```

### Cost Optimization Strategy:
- **API Budget Tracking:** Monitor cost per user per month
- **Smart Batching:** 10x efficiency improvement vs individual calls
- **Intelligent Caching:** 80% reduction in API requests
- **Usage Prediction:** Pre-generate content for active users
- **Fallback Content:** Local suggestions when API unavailable

## TDD Implementation Framework

### Test-First Development Process:
```markdown
For Each Feature:
1. üî¥ RED Phase:
   ‚ñ° Write failing unit tests ‚Üí business logic validation
   ‚ñ° Write failing integration tests ‚Üí API/database interactions
   ‚ñ° Write failing UI tests ‚Üí user interaction validation
   ‚ñ° Write failing AI tests ‚Üí model accuracy and fallback scenarios

2. üü¢ GREEN Phase:
   ‚ñ° Implement minimal code to pass unit tests
   ‚ñ° Implement data layer to pass integration tests
   ‚ñ° Implement UI to pass interaction tests
   ‚ñ° Implement AI integration to pass accuracy tests

3. üîÑ REFACTOR Phase:
   ‚ñ° Optimize code structure and performance
   ‚ñ° Improve test coverage and reliability
   ‚ñ° Clean up code duplication
   ‚ñ° Document implementation decisions
```

### Platform-Specific Testing:
```markdown
Android Testing:
‚ñ° JUnit 5 unit tests ‚Üí business logic + view models
‚ñ° Espresso UI tests ‚Üí user interactions + navigation
‚ñ° Room database tests ‚Üí data persistence validation
‚ñ° Retrofit API tests ‚Üí network layer validation

iOS Testing:
‚ñ° XCTest unit tests ‚Üí business logic + view models  
‚ñ° XCUITest UI tests ‚Üí user interactions + navigation
‚ñ° Core Data tests ‚Üí data persistence validation
‚ñ° URLSession tests ‚Üí network layer validation

Cross-Platform Integration Tests:
‚ñ° Firebase integration tests ‚Üí analytics + remote config
‚ñ° AI API integration tests ‚Üí response validation + caching
‚ñ° Revenue integration tests ‚Üí ads + billing functionality
```

## Quality Assurance Pipeline

### Automated Quality Gates:
```markdown
Pre-Commit Checks:
‚ñ° Unit test coverage ‚Üí minimum 85%
‚ñ° Integration test coverage ‚Üí minimum 70%
‚ñ° UI test coverage ‚Üí critical user flows 100%
‚ñ° Code quality analysis ‚Üí Android Lint + iOS SwiftLint
‚ñ° Performance benchmarks ‚Üí app startup time + memory usage

Pre-Release Checks:
‚ñ° Cross-platform feature parity validation
‚ñ° Revenue integration testing ‚Üí ads + billing functionality
‚ñ° AI integration testing ‚Üí accuracy + performance + fallbacks
‚ñ° Regional configuration testing ‚Üí ad strategies per market
‚ñ° Analytics validation ‚Üí event tracking + attribution
```

### Platform-Specific Optimizations:
```markdown
Android Optimizations:
‚ñ° APK/AAB size optimization ‚Üí ProGuard + R8
‚ñ° Battery usage optimization ‚Üí background processing limits
‚ñ° Memory optimization ‚Üí leak detection + garbage collection
‚ñ° Network optimization ‚Üí request caching + compression

iOS Optimizations:
‚ñ° App size optimization ‚Üí App Thinning + bitcode
‚ñ° Battery usage optimization ‚Üí background app refresh limits
‚ñ° Memory optimization ‚Üí instruments analysis + optimization
‚ñ° Network optimization ‚Üí URLSession configuration + caching
```

## Regional Market Strategy

### Supported Regions with Different Strategies:
```markdown
High Revenue Markets (Max Revenue Strategy):
- Vietnam, India, Brazil, Indonesia
- Higher ad density, aggressive monetization
- Focus on ad revenue optimization

Premium Markets (IAP Conversion Strategy):
- United States, Japan, Germany, UK
- Minimal ads, premium feature focus
- Subscription and one-time purchase optimization

Balanced Markets (Retention Strategy):
- European Union, Canada, Australia, South Korea
- Balanced approach between ads and user experience
- Focus on long-term user retention
```

### Manual Control Dashboard Features:
```markdown
Firebase Remote Config Dashboard:
‚ñ° Real-time strategy switching per region
‚ñ° A/B testing management ‚Üí compare strategies
‚ñ° Revenue analytics ‚Üí performance per strategy per region
‚ñ° User retention tracking ‚Üí strategy impact analysis
‚ñ° Custom strategy creation ‚Üí hybrid approaches
‚ñ° Scheduled strategy changes ‚Üí automatic switching based on time/events
```

## Success Metrics & KPIs

### Revenue Metrics:
- **ARPU (Average Revenue Per User)** per region
- **ARPDAU (Average Revenue Per Daily Active User)**
- **Ad Revenue vs IAP Revenue** breakdown
- **LTV (Lifetime Value)** per user segment
- **Conversion Rate** from free to premium

### Retention Metrics:
- **Day 1, Day 7, Day 30 Retention** rates
- **Session Duration** and frequency
- **Feature Adoption** rates
- **Churn Rate** per strategy per region

### Technical Metrics:
- **App Performance** (startup time, responsiveness)
- **Crash Rate** < 1% across both platforms
- **API Cost Efficiency** (cost per user per month)
- **Test Coverage** (unit, integration, UI tests)

## Implementation Timeline

### Phase 1: Foundation (Week 1-2)
- Strategic information gathering (5 questions)
- Architecture design (Android + iOS compatible)
- Project setup and initial structure

### Phase 2: Core Development (Week 3-6)
- TDD implementation of core features
- AI integration with smart caching
- Cross-platform UI/UX development

### Phase 3: Revenue Integration (Week 7-8)
- Firebase Remote Config setup
- Ad strategy implementation
- IAP integration and testing

### Phase 4: Regional Optimization (Week 9-10)
- Regional strategy configuration
- A/B testing setup
- Performance optimization

### Phase 5: Quality Assurance (Week 11-12)
- Comprehensive testing across platforms
- Performance optimization
- Store preparation (Play Store + App Store)

## Maintenance & Updates

### Continuous Optimization:
```markdown
Weekly Tasks:
‚ñ° Revenue performance analysis per region
‚ñ° A/B testing results evaluation
‚ñ° User feedback analysis and strategy adjustment
‚ñ° AI API cost monitoring and optimization

Monthly Tasks:
‚ñ° Cross-platform feature parity review
‚ñ° New regional market evaluation
‚ñ° Strategy effectiveness analysis
‚ñ° Technical debt reduction

Quarterly Tasks:
‚ñ° Major feature updates planning
‚ñ° Platform-specific optimization reviews
‚ñ° Revenue model evolution planning
‚ñ° Competitive analysis and strategy adjustment
```
